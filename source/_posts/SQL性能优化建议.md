---
title: SQL性能优化建议
date: 2018-8-29 21:59:57
tags: [SQL,数据库]
toc: true
---

近期接到了公司的一个百万级数据库的优化需求，通过在网上查阅资料总结了以下的一些优化建议。

## 查询速度慢的原因
1. **不合理的表设计**
2. **语句未命中索引**
3. 不合理的锁
4. 数据量过大
5. 网络延迟
6. …………

<!-- more -->

## 善用索引，避免全表扫描
* 合理使用索引，避免在索引列做运算
* 应考虑在 where 及 order by 涉及的列上建立索引。
* 应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描。
* 应尽量避免在 where 子句中使用 != 或 <> 操作符，否则将引擎放弃使用索引而进行全表扫描。
* 应尽量避免在 where 子句中使用 or 来连接条件，如果一个字段有索引，一个字段没有索引，将导致引擎放弃使用索引而进行全表扫描
* in 和 not in 也要慎用，否则会导致全表扫描
* 如果在 where 子句中使用参数，也会导致全表扫描。因为SQL只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择推迟到运行时；它必须在编译时进行选择。
* 应尽量避免在where子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。
* 不要在 where 子句中的“=”左边进行函数、算术运算或其他表达式运算，否则系统将可能无法正确使用索引。
* 在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引中的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。
* 避免`like "%keyword%"`,前置通配符会导致全表扫描，如有需要可以做全文索引。

## 避免数据库做多余的操作

* 计算相关在业务层做，数据库尽量避免多余操作
* 避免使用 * ，所有需要的字段都要列出来，做update操作时也一样
* 查询必须要限制数量
* 不要写一些没有意义的查询，如需要生成一个空表结构

## 合理设计表结构

* 设计达到3NF
* 必须将字段定义为NOT NULL并提供默认值
* 避免单表字段过多，必要时进行纵向拆分（做关联表）
* 数据量过大就要考虑做水平切割（分表）
* 避免字段存储大数据块，例如图片
* 统计量可以考虑提取出来